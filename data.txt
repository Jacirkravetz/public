Sub CreatePivotTable(sheetName As String)
    Dim wsSource As Worksheet
    Dim wsPivot As Worksheet
    Dim ptCache As PivotCache
    Dim pt As PivotTable
    Dim dataRange As Range
    Dim pivotSheetName As String
    
    ' Defina a planilha de origem
    On Error Resume Next
    Set wsSource = ThisWorkbook.Sheets(sheetName)
    On Error GoTo 0
    
    If wsSource Is Nothing Then
        MsgBox "Planilha '" & sheetName & "' não encontrada.", vbExclamation
        Exit Sub
    End If
    
    ' Defina o intervalo de dados para a PivotTable
    With wsSource
        Set dataRange = .Range("A1").CurrentRegion ' Considera a região atual como intervalo de dados
    End With
    
    ' Crie uma nova planilha para a PivotTable
    pivotSheetName = "Pivot_" & sheetName
    On Error Resume Next
    Application.DisplayAlerts = False
    Worksheets(pivotSheetName).Delete ' Exclui a planilha se já existir
    Application.DisplayAlerts = True
    On Error GoTo 0
    
    Set wsPivot = ThisWorkbook.Sheets.Add
    wsPivot.Name = pivotSheetName
    
    ' Crie o cache da PivotTable
    Set ptCache = ThisWorkbook.PivotCaches.Create( _
        SourceType:=xlDatabase, _
        SourceData:=dataRange)
    
    ' Crie a PivotTable na nova planilha
    Set pt = ptCache.CreatePivotTable( _
        TableDestination:=wsPivot.Range("A3"), _
        TableName:="PivotTable1")
    
    ' Configure a PivotTable
    With pt
        ' Adicione as colunas, linhas, filtros e valores
        .PivotFields("Months").Orientation = xlColumnField
        .PivotFields("Vendor").Orientation = xlRowField
        .PivotFields("Forecast").Orientation = xlPageField
        .PivotFields("FrancoValue").Orientation = xlDataField
        .PivotFields("FrancoValue").Function = xlSum
        .PivotFields("FrancoValue").NumberFormat = "#,##0.00"
        
        ' Atualize a tabela dinâmica
        .RefreshTable
    End With
    
    MsgBox "PivotTable criada na aba: " & pivotSheetName, vbInformation
End Sub
