Sub CreatePivotTableInWorkbook(wb As Workbook, sourceSheetName As String)
    Dim wsSource As Worksheet
    Dim wsPivot As Worksheet
    Dim ptCache As PivotCache
    Dim pt As PivotTable
    Dim dataRange As Range
    Dim pivotSheetName As String
    
    ' Defina a planilha de origem
    On Error Resume Next
    Set wsSource = wb.Sheets(sourceSheetName)
    On Error GoTo 0
    
    If wsSource Is Nothing Then
        MsgBox "Planilha '" & sourceSheetName & "' não encontrada no Workbook especificado.", vbExclamation
        Exit Sub
    End If
    
    ' Defina o intervalo de dados para a PivotTable
    With wsSource
        Set dataRange = .Range("A1:AB" & .Cells(.Rows.Count, "A").End(xlUp).Row) ' Dados de A até AB
    End With
    
    ' Crie uma nova planilha chamada "PivotTabela" no Workbook
    pivotSheetName = "PivotTabela"
    On Error Resume Next
    Application.DisplayAlerts = False
    wb.Sheets(pivotSheetName).Delete ' Exclui a planilha se já existir
    Application.DisplayAlerts = True
    On Error GoTo 0
    
    Set wsPivot = wb.Sheets.Add
    wsPivot.Name = pivotSheetName
    
    ' Crie o cache da PivotTable
    Set ptCache = wb.PivotCaches.Create( _
        SourceType:=xlDatabase, _
        SourceData:=dataRange)
    
    ' Crie a PivotTable na nova planilha
    Set pt = ptCache.CreatePivotTable( _
        TableDestination:=wsPivot.Range("A3"), _
        TableName:="PivotTable1")
    
    ' Configure a PivotTable
    With pt
        ' Adicione as colunas, linhas, filtros e valores
        .PivotFields("Months").Orientation = xlColumnField
        .PivotFields("Vendor").Orientation = xlRowField
        .PivotFields("Forecast").Orientation = xlPageField
        .PivotFields("FrancoValue").Orientation = xlDataField
        .PivotFields("FrancoValue").Function = xlSum
        .PivotFields("FrancoValue").NumberFormat = "#,##0.00"
        
        ' Atualize a tabela dinâmica
        .RefreshTable
    End With
    
    MsgBox "PivotTable criada na aba: " & pivotSheetName, vbInformation
End Sub


Sub CallCreatePivotTable()
    Dim wb As Workbook
    Set wb = ThisWorkbook ' Altere para o Workbook desejado, se necessário
    Call CreatePivotTableInWorkbook(wb, "NomeDaPlanilhaDeOrigem")
End Sub
