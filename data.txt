Sub CreatePivotTableInWorksheet(wsSource As Worksheet)
    Dim wb As Workbook
    Dim wsPivot As Worksheet
    Dim ptCache As PivotCache
    Dim pt As PivotTable
    Dim dataRange As Range
    Dim pivotSheetName As String
    Dim pivotField As PivotField
    
    ' Obtém o Workbook associado à Worksheet
    Set wb = wsSource.Parent
    
    ' Define o intervalo de dados de A até AB
    With wsSource
        Set dataRange = .Range("A1:AB" & .Cells(.Rows.Count, "A").End(xlUp).Row)
    End With
    
    ' Cria ou recria a aba "PivotTabela"
    pivotSheetName = "PivotTabela"
    On Error Resume Next
    Application.DisplayAlerts = False
    wb.Sheets(pivotSheetName).Delete ' Exclui a planilha se já existir
    Application.DisplayAlerts = True
    On Error GoTo 0
    
    Set wsPivot = wb.Sheets.Add
    wsPivot.Name = pivotSheetName
    
    ' Cria o cache da PivotTable
    Set ptCache = wb.PivotCaches.Create( _
        SourceType:=xlDatabase, _
        SourceData:=dataRange)
    
    ' Cria a PivotTable na aba "PivotTabela"
    Set pt = ptCache.CreatePivotTable( _
        TableDestination:=wsPivot.Range("A3"), _
        TableName:="PivotTable1")
    
    ' Configura os campos da PivotTable
    With pt
        .PivotFields("Months").Orientation = xlColumnField
        .PivotFields("Vendor").Orientation = xlRowField
        .PivotFields("Forecast").Orientation = xlPageField
        
        ' Adiciona o campo de valores "FrancoValue"
        Set pivotField = .PivotFields("FrancoValue")
        pivotField.Orientation = xlDataField
        pivotField.Function = xlSum
        pivotField.NumberFormat = "#,##0.00"
    End With
    
    MsgBox "PivotTable criada na aba: " & pivotSheetName, vbInformation
End Sub

Sub CallCreatePivotTable()
    Dim wsSource As Worksheet
    
    ' Define a planilha de origem
    Set wsSource = ThisWorkbook.Sheets("NomeDaPlanilhaDeOrigem") ' Substitua pelo nome correto da planilha
    
    ' Chama a macro para criar a PivotTable
    CreatePivotTableInWorksheet wsSource
End Sub
